---
import { getCollection, type CollectionEntry } from 'astro:content';

import ContactForm from '../../components/islands/ContactForm';
import WhitepaperRequestForm from '../../components/islands/WhitepaperRequestForm';
import MarketingCtaRow from '../../components/marketing/MarketingCtaRow.astro';
import MarketingHero from '../../components/marketing/MarketingHero.astro';
import MarketingShell from '../../components/marketing/MarketingShell.astro';
import SchemaScript from '../../components/seo/SchemaScript.astro';
import { createMarketingEntryTrail } from '../../utils/breadcrumbs';
import { buildBreadcrumbSchema, buildFaqSchema } from '../../utils/seo';

export async function getStaticPaths() {
  const entries = await getCollection('marketing', ({ id }) => id.startsWith('about/'));
  return entries.map((entry) => ({
    params: { page: entry.slug.split('/').pop() ?? entry.id },
    props: { entry },
  }));
}

interface Props {
  entry: CollectionEntry<'marketing'>;
}

const { entry } = Astro.props as Props;
const { data } = entry;
const { Content } = await entry.render();
const isContactPage = entry.slug === 'about/contact';
const isWhitepaperPage = entry.slug === 'about/white-papers';
const isInvestorsPage = entry.slug === 'about/investors';
const heroCopy =
  data.summary ??
  'Understand the teams, history, and culture powering Apotheon.ai as we scale enterprise platforms.';
const heroCtaLabel = data.heroCtaLabel ?? (isWhitepaperPage ? 'Browse assets' : 'Connect with us');
const breadcrumbs = createMarketingEntryTrail(entry);
const siteOrigin = Astro.site?.origin ?? Astro.url.origin;
const breadcrumbSchema = buildBreadcrumbSchema(breadcrumbs, siteOrigin);
const faqSchema = isContactPage
  ? buildFaqSchema([
      {
        question: 'How quickly will Apotheon.ai respond to my inquiry?',
        answer:
          'Revenue operations monitors the intake queue continuously and routes messages to the appropriate solution engineering pod within minutes.',
      },
      {
        question: 'Who should use the contact form versus emailing directly?',
        answer:
          'Platform evaluations, strategic partnerships, and investor outreach should start with the form so automation captures context, audit signals, and verification artifacts automatically.',
      },
      {
        question: 'Is there a direct email address for urgent conversations?',
        answer:
          'Yes. Email revops@apotheon.ai for time-sensitive requests—the shared inbox automation attaches each thread to your submission record for tracking.',
      },
    ])
  : null;
const schemaPayload = faqSchema ? [breadcrumbSchema, faqSchema] : breadcrumbSchema;
const investorVision = isInvestorsPage ? data.vision : null;
const investorMarket = isInvestorsPage ? data.market : null;
const investorRegulatory = isInvestorsPage ? data.regulatoryStance : null;
const investorRoadmap = isInvestorsPage ? data.roadmap : null;
const investorBrief = isInvestorsPage ? data.investorBrief : null;
const investorCalls = isInvestorsPage ? data.callsToAction : null;
const investorMarketItems = (investorMarket?.verticals ?? [
  'Financial services consolidating risk operations and AI observability.',
  'Healthcare networks modernizing clinical governance without sacrificing compliance.',
  'Public sector missions operationalizing sovereign AI mandates.',
]) as ReadonlyArray<string>;
const investorRegulatoryItems = (investorRegulatory?.commitments ?? [
  'Independent attestation roadmap tracking SOC 2, HITRUST, and FedRAMP milestones.',
  'Policy automation mapped to NIST RMF, ISO 42001, and sector guardrails enforced in platform.',
  'Worker-level audit trails with retention tuned for investor-grade diligence and disclosure readiness.',
]) as ReadonlyArray<string>;
const investorRoadmapItems = (investorRoadmap?.milestones ?? [
  '2025 Q1 — Launch zero-knowledge attestation exchange for low-friction assurance sharing.',
  '2025 Q2 — Expand automation studio marketplace with certified partner playbooks.',
  '2025 Q3 — Deliver international data residency controls with configurable key management.',
  '2025 Q4 — Release investor analytics dashboard streaming revenue and compliance telemetry.',
]) as ReadonlyArray<string>;

const heroCtaHref = isWhitepaperPage
  ? '#whitepaper-request'
  : isInvestorsPage
    ? (investorCalls?.primaryHref ?? '/about/contact/?team=investor-relations')
    : '/about/contact/';
const heroCtaDescription = isWhitepaperPage
  ? 'Jump directly to the gated asset request workflow powered by the delivery Worker.'
  : isInvestorsPage
    ? 'Route straight to investor relations with analytics-ready flags applied to your submission.'
    : 'Direct message routes into the RevOps-managed intake queue.';
---

<MarketingShell title={data.title} description={heroCopy} {breadcrumbs}>
  <SchemaScript slot="head" schema={schemaPayload} />
  <MarketingHero
    eyebrow="About"
    headline={data.title}
    copy={heroCopy}
    cta={{
      label: heroCtaLabel,
      href: heroCtaHref,
      description: heroCtaDescription,
    }}
  />

  <!--
    About pages welcome more narrative storytelling. Feel free to embed imagery or data visualizations
    with MDX imports in future iterations. Keep alt text descriptive and ensure charts ship with
    table-based fallbacks for accessibility.
  -->
  <article
    class="prose prose-invert prose-headings:font-semibold prose-headings:text-white prose-p:text-slate-200 prose-a:text-indigo-300 max-w-none"
  >
    <Content />
  </article>

  {
    isInvestorsPage && (
      <section class="mt-12 grid gap-8" aria-labelledby="investor-overview">
        <div class="grid gap-4">
          <h2 id="investor-overview" class="text-2xl font-semibold text-white">
            Investor enablement briefing
          </h2>
          <p class="max-w-4xl text-slate-300">
            {/* The extra copy below mirrors the MDX narrative but structures key diligence threads so IR can reference a single */}
            {/* canonical layout. Frontmatter drives the bullet lists so Finance, Compliance, and GTM partners can update without */}
            {/* editing JSX. */}
            {investorVision?.narrative ??
              "Review the metrics, governance pillars, and automation cadence powering Apotheon.ai's investor readiness program."}
          </p>
        </div>

        <div class="grid gap-6 md:grid-cols-2">
          <div class="grid gap-3 rounded-xl border border-slate-700 bg-slate-900/60 p-6 shadow-lg shadow-slate-950/40">
            <h3 class="text-xl font-semibold text-white">
              {investorVision?.headline ?? 'Compounding trust. Compounding growth.'}
            </h3>
            <p class="text-slate-300">
              {investorVision?.narrative ??
                'Apotheon.ai automates governance, telemetry, and assurance so regulated enterprises expand AI safely while compounding revenue.'}
            </p>
          </div>

          <div class="grid gap-3 rounded-xl border border-slate-700 bg-slate-900/60 p-6 shadow-lg shadow-slate-950/40">
            <h3 class="text-xl font-semibold text-white">
              {investorMarket?.headline ?? 'Where we win today'}
            </h3>
            <ul class="list-disc space-y-2 pl-5 text-slate-300">
              {investorMarketItems.map((item: string) => (
                <li>{item}</li>
              ))}
            </ul>
          </div>
        </div>

        <div class="grid gap-6 md:grid-cols-2">
          <div class="grid gap-3 rounded-xl border border-slate-700 bg-slate-900/60 p-6 shadow-lg shadow-slate-950/40">
            <h3 class="text-xl font-semibold text-white">
              {investorRegulatory?.headline ?? 'Regulation is our accelerant'}
            </h3>
            <ul class="list-disc space-y-2 pl-5 text-slate-300">
              {investorRegulatoryItems.map((item: string) => (
                <li>{item}</li>
              ))}
            </ul>
          </div>

          <div class="grid gap-3 rounded-xl border border-slate-700 bg-slate-900/60 p-6 shadow-lg shadow-slate-950/40">
            <h3 class="text-xl font-semibold text-white">
              {investorRoadmap?.headline ?? 'Roadmap signals through the next six quarters'}
            </h3>
            <ul class="list-disc space-y-2 pl-5 text-slate-300">
              {investorRoadmapItems.map((item: string) => (
                <li>{item}</li>
              ))}
            </ul>
          </div>
        </div>

        <div class="grid gap-6 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]">
          <div class="grid gap-4 rounded-xl border border-slate-700 bg-slate-900/60 p-6 shadow-lg shadow-slate-950/40">
            <h3 class="text-xl font-semibold text-white">Investor brief automation</h3>
            <p class="text-slate-300">
              {investorBrief?.summary ??
                'Download the diligence-ready PDF curated for institutional partners. Distribution runs through the whitepaper Worker so telemetry, signed URLs, and revocation stay centralized.'}
            </p>
            <dl class="grid gap-2 text-sm text-slate-400">
              <div class="grid gap-1">
                <dt class="font-semibold text-slate-200">R2 object key</dt>
                <dd>
                  <code>
                    {investorBrief?.objectKey ?? 'whitepapers/apotheon-investor-brief.pdf'}
                  </code>
                </dd>
              </div>
              <div class="grid gap-1">
                <dt class="font-semibold text-slate-200">Steward</dt>
                <dd>{investorBrief?.lastReviewedBy ?? 'ir@apotheon.ai'}</dd>
              </div>
            </dl>
            <div class="flex flex-wrap gap-3">
              <a
                href={investorCalls?.primaryHref ?? '/about/contact/?team=investor-relations'}
                class="inline-flex items-center justify-center rounded-md bg-indigo-500 px-4 py-2 text-sm font-semibold text-white shadow-lg shadow-indigo-500/30 transition hover:bg-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
              >
                {investorCalls?.primaryLabel ?? 'Speak with investor relations'}
              </a>
              <a
                href="/about/white-papers/#whitepaper-request"
                class="inline-flex items-center justify-center rounded-md border border-indigo-400 px-4 py-2 text-sm font-semibold text-indigo-200 transition hover:border-indigo-300 hover:text-indigo-100 focus:outline-none focus:ring-2 focus:ring-indigo-400"
              >
                {investorCalls?.secondaryLabel ?? 'Request the investor brief'}
              </a>
            </div>
          </div>

          <aside class="grid gap-4 rounded-xl border border-slate-700 bg-slate-900/40 p-6 text-sm text-slate-300 shadow-inner shadow-slate-950/20">
            <h3 class="text-base font-semibold text-white">Automation checklist</h3>
            <ul class="list-disc space-y-2 pl-5">
              <li>
                Ensure investor submissions include the <code>team=investor-relations</code> query
                so ContactForm preselects the intent and logs analytics.
              </li>
              <li>
                Reconcile investor brief downloads weekly using the Worker\'s D1 ledger to confirm
                signed URLs were redeemed by approved domains.
              </li>
              <li>
                When the PDF updates, rerun <code>npm run ensure:whitepapers</code> so the checksum
                and manifest stay in lockstep.
              </li>
            </ul>
          </aside>
        </div>
      </section>
    )
  }

  {
    isContactPage && (
      <section class="mt-12 grid gap-6">
        <h2 class="text-2xl font-semibold text-white">Engage with our enterprise concierge</h2>
        <p class="max-w-3xl text-slate-300">
          Submissions sync directly into RevOps-owned systems with rate limiting, domain vetting,
          and audit trails managed by the Cloudflare Worker launched in this change.
        </p>
        <ContactForm client:load />
      </section>
    )
  }

  {
    isWhitepaperPage && (
      <section id="whitepaper-request" class="mt-12 grid gap-6">
        <h2 class="text-2xl font-semibold text-white">Request enterprise whitepapers</h2>
        <p class="max-w-3xl text-slate-300">
          Select the guide that aligns with your initiative, confirm compliance context, and our
          Cloudflare Worker will issue a short-lived signed URL after Turnstile verification and MX
          checks.
        </p>
        <WhitepaperRequestForm client:load />
        <p class="text-sm text-slate-500">
          {/* Automation reminder: Marketing automation should pull download events from the data layer to enrich nurture KPIs. */}
          Submission analytics stream into the global <code>dataLayer</code> so marketing ops can
          reconcile nurture performance against the Worker audit ledger.
        </p>
      </section>
    )
  }

  <MarketingCtaRow
    items={[
      {
        title: 'Read our operating principles',
        description:
          'See the guardrails steering product decisions, hiring, and customer engagement.',
        href: '/about/company/',
        label: 'Explore the manifesto',
      },
      {
        title: 'Meet the leadership team',
        description:
          'Deep dive into the cross-functional leaders guiding delivery, research, and success.',
        href: '/about/team/',
        label: 'Review leadership bios',
      },
      {
        title: 'Join the mission',
        description:
          'Preview roles across engineering, go-to-market, and operations as we scale globally.',
        href: '/about/careers/',
        label: 'Browse open roles',
      },
    ]}
  />
</MarketingShell>

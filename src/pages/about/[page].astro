---
import { getCollection, type CollectionEntry } from 'astro:content';

import ContactForm from '../../components/islands/ContactForm';
import MarketingCtaRow from '../../components/marketing/MarketingCtaRow.astro';
import MarketingHero from '../../components/marketing/MarketingHero.astro';
import MarketingShell from '../../components/marketing/MarketingShell.astro';
import SchemaScript from '../../components/seo/SchemaScript.astro';
import { createMarketingEntryTrail } from '../../utils/breadcrumbs';
import { buildBreadcrumbSchema, buildFaqSchema } from '../../utils/seo';

export async function getStaticPaths() {
  const entries = await getCollection('marketing', ({ id }) => id.startsWith('about/'));
  return entries.map((entry) => ({
    params: { page: entry.slug.split('/').pop() ?? entry.id },
    props: { entry },
  }));
}

interface Props {
  entry: CollectionEntry<'marketing'>;
}

const { entry } = Astro.props as Props;
const { data } = entry;
const { Content } = await entry.render();
const isContactPage = entry.slug === 'about/contact';
const heroCopy =
  data.summary ??
  'Understand the teams, history, and culture powering Apotheon.ai as we scale enterprise platforms.';
const heroCtaLabel = data.heroCtaLabel ?? 'Connect with us';
const breadcrumbs = createMarketingEntryTrail(entry);
const siteOrigin = Astro.site?.origin ?? Astro.url.origin;
const breadcrumbSchema = buildBreadcrumbSchema(breadcrumbs, siteOrigin);
const faqSchema = isContactPage
  ? buildFaqSchema([
      {
        question: 'How quickly will Apotheon.ai respond to my inquiry?',
        answer:
          'Revenue operations monitors the intake queue continuously and routes messages to the appropriate solution engineering pod within minutes.',
      },
      {
        question: 'Who should use the contact form versus emailing directly?',
        answer:
          'Platform evaluations, strategic partnerships, and investor outreach should start with the form so automation captures context, audit signals, and verification artifacts automatically.',
      },
      {
        question: 'Is there a direct email address for urgent conversations?',
        answer:
          'Yes. Email revops@apotheon.ai for time-sensitive requestsâ€”the shared inbox automation attaches each thread to your submission record for tracking.',
      },
    ])
  : null;
const schemaPayload = faqSchema ? [breadcrumbSchema, faqSchema] : breadcrumbSchema;
---

<MarketingShell title={data.title} description={heroCopy} {breadcrumbs}>
  <SchemaScript slot="head" schema={schemaPayload} />
  <MarketingHero
    eyebrow="About"
    headline={data.title}
    copy={heroCopy}
    cta={{
      label: heroCtaLabel,
      href: '/about/contact/',
      description: 'Direct message routes into the RevOps-managed intake queue.',
    }}
  />

  <!--
    About pages welcome more narrative storytelling. Feel free to embed imagery or data visualizations
    with MDX imports in future iterations. Keep alt text descriptive and ensure charts ship with
    table-based fallbacks for accessibility.
  -->
  <article
    class="prose prose-invert prose-headings:font-semibold prose-headings:text-white prose-p:text-slate-200 prose-a:text-indigo-300 max-w-none"
  >
    <Content />
  </article>

  {
    isContactPage && (
      <section class="mt-12 grid gap-6">
        <h2 class="text-2xl font-semibold text-white">Engage with our enterprise concierge</h2>
        <p class="max-w-3xl text-slate-300">
          Submissions sync directly into RevOps-owned systems with rate limiting, domain vetting,
          and audit trails managed by the Cloudflare Worker launched in this change.
        </p>
        <ContactForm client:load />
      </section>
    )
  }

  <MarketingCtaRow
    items={[
      {
        title: 'Read our operating principles',
        description:
          'See the guardrails steering product decisions, hiring, and customer engagement.',
        href: '/about/company/',
        label: 'Explore the manifesto',
      },
      {
        title: 'Meet the leadership team',
        description:
          'Deep dive into the cross-functional leaders guiding delivery, research, and success.',
        href: '/about/team/',
        label: 'Review leadership bios',
      },
      {
        title: 'Join the mission',
        description:
          'Preview roles across engineering, go-to-market, and operations as we scale globally.',
        href: '/about/careers/',
        label: 'Browse open roles',
      },
    ]}
  />
</MarketingShell>

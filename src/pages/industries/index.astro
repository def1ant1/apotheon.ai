---
import { getCollection } from 'astro:content';

import { resolveIndustryIcon } from '../../components/industries/icon-map';
import MarketingCtaRow from '../../components/marketing/MarketingCtaRow.astro';
import MarketingHero from '../../components/marketing/MarketingHero.astro';
import MarketingShell from '../../components/marketing/MarketingShell.astro';
import { createMarketingIndexTrail } from '../../utils/breadcrumbs';

const industryEntries = await getCollection('industries', ({ data }) => !data.draft);
const industries = industryEntries
  .map((entry) => ({
    title: entry.data.title,
    summary: entry.data.hero.copy,
    href: `/industries/${entry.slug}/`,
    featured: entry.data.featured,
    order: entry.data.order,
    icon: entry.data.hero.icon,
    slug: entry.slug,
  }))
  .sort((a, b) => (a.order === b.order ? a.title.localeCompare(b.title) : a.order - b.order));

const heroCopy =
  'Assess how Apotheon.ai adapts the platform for the regulations and missions you manage.';
const breadcrumbs = createMarketingIndexTrail('industries');
---

<MarketingShell title="Industries" description={heroCopy} {breadcrumbs}>
  <MarketingHero
    eyebrow="Industries"
    headline="Purpose-built industry playbooks"
    copy={heroCopy}
    cta={{
      label: 'Pair with our specialists',
      href: '/about/contact/',
      description: 'Vertical strategists align go-live plans with compliance checkpoints.',
    }}
  />

  <section class="flex flex-col gap-6">
    <h2 class="text-2xl font-semibold text-white">Industry guides</h2>
    <p class="text-sm text-slate-400">
      Each card resolves from <code>src/content/industries</code> so editors manage tone, keywords, and
      compliance promises without touching templates.
    </p>
    <div class="grid gap-4 md:grid-cols-3">
      {
        industries.map((industry) => {
          const Icon = resolveIndustryIcon(industry.icon);
          return (
            <a
              class={`flex h-full flex-col gap-3 rounded-2xl border border-slate-800 bg-slate-950/40 p-6 transition hover:border-indigo-500 ${
                industry.featured ? 'ring-1 ring-indigo-500/40' : ''
              }`}
              href={industry.href}
              id={`industry-card-${industry.slug}`}
              data-analytics-id={`industry-card-${industry.slug}`}
            >
              <span class="text-xs uppercase tracking-[0.35rem] text-indigo-300">
                {industry.featured ? 'Priority vertical' : 'Industry'}
              </span>
              <div class="flex items-center gap-3">
                <div class="flex h-12 w-12 items-center justify-center rounded-xl border border-indigo-500/40 bg-indigo-500/10">
                  <Icon className="h-6 w-6 text-indigo-200" aria-hidden="true" focusable="false" />
                  <span class="sr-only">{industry.title} icon</span>
                </div>
                <span class="text-lg font-semibold text-white">{industry.title}</span>
              </div>
              <span class="text-sm text-slate-300">{industry.summary}</span>
            </a>
          );
        })
      }
    </div>
  </section>

  <MarketingCtaRow
    heading="Build your rollout coalition"
    items={[
      {
        title: 'Sync with governance',
        description: 'Introduce risk and compliance leads to our security principals early.',
        href: '/about/contact/',
        label: 'Coordinate a workshop',
      },
      {
        title: 'Preview implementation services',
        description:
          'See how the delivery team runs migrations, data cleanup, and change management.',
        href: '/solutions/clio/',
        label: 'Review delivery patterns',
      },
      {
        title: 'Capture executive alignment',
        description: 'Share the company overview to align CIO, CDO, and CISO stakeholders.',
        href: '/about/company/',
        label: 'Share leadership brief',
      },
    ]}
  />
</MarketingShell>

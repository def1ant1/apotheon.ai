---
import { getCollection, type CollectionEntry } from 'astro:content';

import IndustryCompliance from '../../components/industries/IndustryCompliance.astro';
import IndustryCtaBanner from '../../components/industries/IndustryCtaBanner.astro';
import IndustryHero from '../../components/industries/IndustryHero.astro';
import IndustryPressures from '../../components/industries/IndustryPressures.astro';
import IndustrySolutionMap from '../../components/industries/IndustrySolutionMap.astro';
import IndustryUseCases from '../../components/industries/IndustryUseCases.astro';
import MarketingShell from '../../components/marketing/MarketingShell.astro';
import { normalizeTrail } from '../../utils/breadcrumbs';

export async function getStaticPaths() {
  const entries = await getCollection('industries', ({ data }) => !data.draft);
  return entries.map((entry) => ({
    params: { sector: entry.slug },
    props: { entry },
  }));
}

interface Props {
  entry: CollectionEntry<'industries'>;
}

const { entry } = Astro.props as Props;
const { data } = entry;
const solutions = await getCollection('solutions', ({ data }) => !data.draft);
const breadcrumbs = normalizeTrail([
  { label: 'Industries', href: '/industries/' },
  { label: data.title, href: `/industries/${entry.slug}/` },
]);
const pageDescription = data.seo?.description ?? data.hero.copy;
---

<MarketingShell title={data.title} description={pageDescription} {breadcrumbs}>
  <!--
    Each section below renders from structured frontmatter so industry editors ship updates without
    touching templates. Ordering mirrors the briefing narrative requested by enterprise procurement:
    hero → pressures → solution mapping → use cases → compliance → conversion banner.
  -->
  <IndustryHero hero={data.hero} title={data.title} />
  <IndustryPressures pressures={data.pressures} />
  <IndustrySolutionMap solutionMap={data.solutionMap} {solutions} />
  <IndustryUseCases useCases={data.useCases} />
  <IndustryCompliance complianceHighlights={data.complianceHighlights} />
  <IndustryCtaBanner ctas={data.ctas} />
</MarketingShell>

---
import { getFooterContact, getFooterColumns, getFooterLegalLinks } from './navigationData';
import { useTranslations } from '../../i18n/runtime';
import PrefetchController, { PREFETCH_ATTRIBUTE_PAYLOAD } from '../islands/PrefetchController';
import PrefetchFlushOrchestrator from '../islands/PrefetchFlushOrchestrator';

const { t } = await useTranslations(Astro);
const navigationColumns = await getFooterColumns(t);
const footerContact = getFooterContact(t);
const footerLegalLinks = getFooterLegalLinks(t);
const currentYear = new Date().getFullYear();
---

{
  /**
  Footer exposes the `contentinfo` landmark so screen readers can jump directly to compliance links
  and contact data. Keeping this annotation here—rather than relying on implicit semantics—guards
  against regressions if future contributors wrap the footer with additional layout containers.
*/
}
<footer
  role="contentinfo"
  aria-label={t('footer.aria.contentInfo', { defaultValue: 'Primary site footer' })}
  class="border-border-subtle/60 bg-surface-raised/40 text-body-sm text-ink-secondary border-t"
>
  {
    /**
    Hydrate the shared PrefetchController here so the footer's dense navigation grid immediately
    benefits from speculative loading without each column rolling its own integration.
  */
  }
  <PrefetchController client:idle />
  {
    /**
    Co-locate the analytics flush orchestrator so consent-gated telemetry drains from every layout
    that renders the footer. The helper short-circuits when storages are unavailable (private
    browsing, etc.) so SSR paths remain unaffected.
  */
  }
  <PrefetchFlushOrchestrator client:idle />
  <div class="gap-space-xl px-gutter-inline py-space-2xl mx-auto flex w-full max-w-6xl flex-col">
    <!--
      Navigation columns consume the same data contract as the header. This keeps the IA consistent
      across surfaces and ensures CMS-driven updates flow into the footer without manual edits.
    -->
    <div
      class="gap-space-lg xl:gap-space-xl grid sm:grid-cols-2 lg:grid-cols-[repeat(4,minmax(0,1fr))]"
    >
      {
        navigationColumns.map((column) => {
          const headingId = `footer-${column.title.toLowerCase().replace(/[^a-z0-9]+/g, '-')}`;

          return (
            <nav aria-labelledby={headingId} class="space-y-space-xs">
              <h2 id={headingId} class="text-title-md text-ink-primary font-semibold">
                {column.title}
              </h2>
              {column.summary && <p class="text-body-sm text-ink-muted">{column.summary}</p>}
              <ul class="space-y-space-3xs">
                {column.links.map((link) => (
                  <li>
                    <a
                      {...PREFETCH_ATTRIBUTE_PAYLOAD}
                      class="gap-space-3xs text-body-sm text-ink-secondary hover:text-accent-brand inline-flex items-center font-semibold transition-colors"
                      href={link.href}
                    >
                      {link.label}
                    </a>
                  </li>
                ))}
              </ul>
            </nav>
          );
        })
      }

      <nav aria-labelledby="footer-legal" class="space-y-space-xs">
        <h2 id="footer-legal" class="text-title-md text-ink-primary font-semibold">
          {t('footer.legal.heading', { defaultValue: 'Legal' })}
        </h2>
        <p class="text-body-sm text-ink-muted">
          {
            t('footer.legal.summary', {
              defaultValue:
                'Policy documents stay versioned alongside the marketing IA so governance stakeholders track exactly which commitments ship with each release.',
            })
          }
        </p>
        <ul class="space-y-space-3xs">
          {
            footerLegalLinks.map((link) => (
              <li>
                <a
                  {...PREFETCH_ATTRIBUTE_PAYLOAD}
                  class="gap-space-3xs text-body-sm text-ink-secondary hover:text-accent-brand inline-flex items-center font-semibold transition-colors"
                  href={link.href}
                >
                  {link.label}
                </a>
              </li>
            ))
          }
        </ul>
      </nav>
    </div>

    <!--
      Contact block doubles as the connective tissue for CRM automation. We intentionally break the
      address into discrete lines and keep interactive elements (`mailto`, `tel`) accessible so the
      marketing site, PDFs, and JSON-LD feeds can reuse the same metadata without reformatting.
    -->
    <section
      aria-labelledby="footer-contact"
      class="gap-space-sm rounded-radius-xl border-border-subtle/60 bg-surface-base/70 p-space-lg shadow-elevation-1 flex flex-col border"
    >
      <div>
        <h2 id="footer-contact" class="text-title-md text-ink-primary font-semibold">
          {t('footer.contact.heading', { defaultValue: 'Contact Apotheon.ai' })}
        </h2>
        <p class="text-body-sm text-ink-muted">
          {
            t('footer.contact.summary', {
              defaultValue:
                'Reach out to route opportunities into the orchestration queue. Automated intake ensures every request hits the correct RevOps workflow without manual triage.',
            })
          }
        </p>
      </div>

      <div
        class="gap-space-3xs sm:gap-space-lg flex flex-col sm:flex-row sm:flex-wrap sm:items-start"
      >
        <address class="not-italic">
          <span class="text-ink-primary block font-semibold">{footerContact.organization}</span>
          {
            footerContact.addressLines.map((line) => (
              <span class="text-body-sm text-ink-secondary block">{line}</span>
            ))
          }
        </address>

        <dl class="gap-space-3xs flex flex-col">
          <div>
            <dt class="text-caption text-ink-muted tracking-wide uppercase">
              {t('footer.contact.labels.email', { defaultValue: 'Email' })}
            </dt>
            <dd>
              <a class="text-body-sm font-semibold" href={`mailto:${footerContact.email}`}>
                {footerContact.email}
              </a>
            </dd>
          </div>
          <div>
            <dt class="text-caption text-ink-muted tracking-wide uppercase">
              {t('footer.contact.labels.phone', { defaultValue: 'Phone' })}
            </dt>
            <dd>
              <a class="text-body-sm font-semibold" href={`tel:${footerContact.phone}`}>
                {footerContact.phone}
              </a>
            </dd>
          </div>
          <div>
            <dt class="text-caption text-ink-muted tracking-wide uppercase">
              {t('footer.contact.labels.officeHours', { defaultValue: 'Office Hours' })}
            </dt>
            <dd class="text-body-sm text-ink-secondary font-semibold">
              {footerContact.officeHours}
            </dd>
          </div>
        </dl>
      </div>
    </section>

    <div
      class="gap-space-3xs text-caption text-ink-muted flex flex-col sm:flex-row sm:items-center sm:justify-between"
    >
      <p>
        {
          t('footer.bottom.copyright', {
            year: currentYear,
            defaultValue: '© {{year}} Apotheon.ai — Astro powered, edge-ready delivery.',
          })
        }
      </p>
      <p>
        {
          t('footer.bottom.automationSummary.beforeCommand', {
            defaultValue:
              'Pagefind search indexes, sitemaps, and robots.txt regenerate during CI/CD via ',
          })
        }
        <code>npm run build</code>
        {
          t('footer.bottom.automationSummary.afterCommand', {
            defaultValue:
              ', ensuring the static bundle remains search-friendly without a custom backend.',
          })
        }
      </p>
    </div>
  </div>
</footer>

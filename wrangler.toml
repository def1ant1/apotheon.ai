name = "apotheon-csp-report-handler"
account_id = "00000000000000000000000000000000"
main = "workers/csp-report-handler.ts"
compatibility_date = "2024-10-08"
compatibility_flags = ["nodejs_compat"]
usage_model = "bundled"

[[routes]]
pattern = "csp.apotheon.ai/report"
custom_domain = true

# The default configuration above deploys the CSP ingestion Worker. Additional
# Workers are represented as dedicated `env.*` sections below so Wrangler can
# deploy each entry point by invoking `wrangler deploy --env <name>`.

[env.contact_intake]
name = "apotheon-contact-intake"
main = "workers/contact.ts"
usage_model = "standard"
compatibility_date = "2024-10-08"
migrations_dir = "workers/migrations/contact"

[[env.contact_intake.routes]]
pattern = "apotheon.ai/api/contact"
custom_domain = true

[[env.contact_intake.routes]]
pattern = "contact.apotheon.ai/*"
custom_domain = true

[[env.contact_intake.kv_namespaces]]
binding = "CONTACT_RATE_LIMIT"
id = "00000000000000000000000000000000"
preview_id = "11111111111111111111111111111111"

[[env.contact_intake.d1_databases]]
binding = "CONTACT_AUDIT_DB"
database_name = "apotheon-contact"
database_id = "00000000-0000-0000-0000-000000000000"

[env.contact_intake.vars]
CONTACT_BLOCKLIST = ""
CONTACT_ALLOWLIST = ""

[env.whitepaper_delivery]
name = "apotheon-whitepaper-delivery"
main = "workers/whitepapers.ts"
usage_model = "standard"
compatibility_date = "2024-10-08"
migrations_dir = "workers/migrations/whitepapers"

[[env.whitepaper_delivery.routes]]
pattern = "apotheon.ai/api/whitepapers"
custom_domain = true

[[env.whitepaper_delivery.kv_namespaces]]
binding = "WHITEPAPER_RATE_LIMIT"
id = "00000000000000000000000000000000"
preview_id = "11111111111111111111111111111111"

[[env.whitepaper_delivery.d1_databases]]
binding = "WHITEPAPER_AUDIT_DB"
database_name = "apotheon-whitepapers"
database_id = "00000000-0000-0000-0000-000000000001"

[[env.whitepaper_delivery.r2_buckets]]
binding = "WHITEPAPER_ASSETS"
bucket_name = "apotheon-whitepapers"
preview_bucket_name = "apotheon-whitepapers-preview"

[env.whitepaper_delivery.vars]
WHITEPAPER_BLOCKLIST = ""
WHITEPAPER_ALLOWLIST = ""
WHITEPAPER_SIGNING_TTL_SECONDS = "900"

[env.blog_analytics]
name = "apotheon-blog-analytics"
main = "workers/blog-analytics.ts"
usage_model = "standard"
compatibility_date = "2024-10-08"
migrations_dir = "workers/migrations/blog-analytics"

[[env.blog_analytics.routes]]
pattern = "analytics.apotheon.ai/*"
custom_domain = true

[[env.blog_analytics.d1_databases]]
binding = "BLOG_ANALYTICS_DB"
database_name = "apotheon-blog-analytics"
database_id = "00000000-0000-0000-0000-000000000002"

[env.blog_analytics.vars]
BLOG_ANALYTICS_ALLOWED_ORIGINS = "https://apotheon.ai,https://www.apotheon.ai"
BLOG_ANALYTICS_DATA_RETENTION_DAYS = "180"
# Secrets managed via `wrangler secret put BLOG_ANALYTICS_BI_API_KEY` to keep BI
# credentials out of version control.

[env.analytics_proxy]
name = "apotheon-analytics-proxy"
main = "workers/analytics-proxy.ts"
usage_model = "standard"
compatibility_date = "2024-10-08"
migrations_dir = "workers/migrations/analytics"

[[env.analytics_proxy.routes]]
pattern = "collect.apotheon.ai/*"
custom_domain = true

[[env.analytics_proxy.kv_namespaces]]
binding = "ANALYTICS_RATE_LIMIT"
id = "00000000000000000000000000000005"
preview_id = "11111111111111111111111111111115"

[[env.analytics_proxy.d1_databases]]
binding = "ANALYTICS_AUDIT_DB"
database_name = "apotheon-analytics-audit"
database_id = "00000000-0000-0000-0000-000000000005"

[env.analytics_proxy.vars]
ANALYTICS_BACKEND_URL = "https://analytics.apotheon.ai"
ANALYTICS_ALLOWED_ORIGINS = "https://apotheon.ai,https://www.apotheon.ai"
ANALYTICS_RATE_LIMIT_MAX = "120"
ANALYTICS_RATE_LIMIT_WINDOW_SECONDS = "60"
# Secrets managed via `wrangler secret put ANALYTICS_PROXY_SECRET` so the
# signing key never lands in git history.

[env.seo_monitor]
name = "apotheon-seo-monitor"
main = "workers/seo-monitor.ts"
usage_model = "standard"
compatibility_date = "2024-10-08"
migrations_dir = "workers/migrations/seo-monitor"

[[env.seo_monitor.triggers]]
crons = ["0 */6 * * *"]

[[env.seo_monitor.d1_databases]]
binding = "SEO_MONITOR_DB"
database_name = "apotheon-seo-monitor"
database_id = "00000000-0000-0000-0000-000000000003"

[env.seo_monitor.vars]
SEO_MONITOR_CRUX_COLLECTION = "ALL_FORM_FACTORS"
SEO_MONITOR_PROPERTY_STAGE = "production"
SEO_MONITOR_COVERAGE_ERROR_THRESHOLD = "0"
# Secrets managed via `wrangler secret put SEO_MONITOR_CRUX_API_KEY`,
# `wrangler secret put SEO_MONITOR_SEARCH_CONSOLE_TOKEN`, and
# `wrangler secret put SEO_MONITOR_ALERT_WEBHOOK`.

[env.og_images]
name = "apotheon-og-images"
main = "workers/og-images.ts"
usage_model = "standard"
compatibility_date = "2024-10-08"
migrations_dir = "workers/migrations/og-images"

[[env.og_images.routes]]
pattern = "og.apotheon.ai/*"
custom_domain = true

[[env.og_images.kv_namespaces]]
binding = "OG_IMAGE_CACHE"
id = "00000000000000000000000000000006"
preview_id = "11111111111111111111111111111116"

[[env.og_images.d1_databases]]
binding = "OG_IMAGE_ASSET_DB"
database_name = "apotheon-og-assets"
database_id = "00000000-0000-0000-0000-000000000006"

[env.og_images.vars]
OG_IMAGE_CACHE_TTL_SECONDS = "604800"
OG_IMAGE_ALLOWED_SCOPES = "blog,marketing"
OG_IMAGE_ALLOWED_THEMES = "dark,light"
